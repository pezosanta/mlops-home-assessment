name: Image Classifier Training

on: 
  workflow_dispatch:
    inputs:
      experiment_name:
        type: string
        required: true
      run_name:
        type: string
        required: true
      dataset:
        type: choice
        default: cifar_dataset
        options:
          - cifar_dataset
        required: true
      learning_rate:
        type: number
        default: 0.001
      momentum:
        type: number
        default: 0.9
      num_epochs:
        type: number
        default: 3
      batch_size:
        type: number
        default: 4
      pretrained_model:
        type: string
        default: "''"
  pull_request:


jobs:
  training:
    name: Training the Image Classifier model
    runs-on: ubuntu-22.04
    steps:
    - name: Checkout repository with GIT LFS
      uses: actions/checkout@v4
      with:
        lfs: true
    - name: Setting up Python3.10
      uses: actions/setup-python@v5
      with:
        python-version: "3.10"
    - name: Installing code development requirements
      run: |
        source requirements-dev.sh
    - name: Running the Training (main) script
      run: >
        image_classifier_trainer --experiments_folder experiments --experiment_name ${{ inputs.experiment_name }} --run_name ${{ inputs.run_name }}  
        --dataset_folder data/${{ inputs.dataset }} --learning_rate ${{ inputs.learning_rate }} --momentum ${{ inputs.momentum }}
        --num_epochs ${{ inputs.num_epochs }} --batch_size ${{ inputs.batch_size }} --pretrained_model ${{ inputs.pretrained_model }}
        --db_pass ZA68eWqt8VWBTQwPBrpI
    - name: Publish experiment results
      uses: actions/upload-artifact@v4
      with:
        name: experiment_results
        path: experiments/${{ inputs.experiment_name }}/${{ inputs.run_name }}
